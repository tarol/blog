---
title: 从AOP到装饰器—写在decorators发布之前
date: 2022-01-05 20:58:38
tags:
  - 文章
  - ES
categories:
  - 技术
  - 前端
  - ES
---

decorators大概是TC39中最历经磨难还坚强活着的proposals了，关于它的历史在[TC39 标准追踪：babel 中的 decorators](/blog/2018/09/22/TC39%20%E6%A0%87%E5%87%86%E8%BF%BD%E8%B8%AA%EF%BC%9Ababel%20%E4%B8%AD%E7%9A%84%20decorators/)一文中比较详尽的说明。那篇译文是站在新旧两份提案对比的角度做了一些抉择上细致的说明。这篇文章我就站在PL的角度，从AOP开聊，说说装饰器的出现和使用场景，以及在新提案下如何正确的使用装饰器提升开发体验。

首先什么是AOP呢，简单的说是面向切面编程，对应的是OOP，也就是我们常说的面向对象编程。所以AOP是站在OOP的对立面，是另一种编程理念吗？当然不是，AOP是OOP在编程方式上一个很好的补充，两者是互补的关系😉。

比如我们有一个类，类里面有很多方法，我们要在每个方法的开始和结束打log，或者统计每个方法执行的耗时，那么最直观的方式是，我们在每个方法的开始和结束添加对应的代码，执行对应的操作。

但是问题就来了，首先，我们需要在每个方法中添加重复的代码，而且必须保证这些代码的位置是准确的；其次，在不同的类中我们要添加同样的代码，一旦修改我们还要统一进行修改；最后，从优雅的角度来说，这部分代码跟类本身的业务属性是无关的，它们是基于另一个逻辑目的而执行的。

要解决以上的目的，我们要设计一种机制，首先在约定的地方准确的插入对应的执行代码，其次这部分代码必须统一起来维护在一个地方，最后它的侵入代价很小，最好是以一种特定语法的形式出现的方法固定的地方。

以上说的前两点说的是一种技术理念，即AOP，如果说类解决的是横向业务的问题，即不同的类面向不同的业务场景，AOP解决的是纵向技术的问题，即不同的函数处理不同的技术问题。那样我们的架构才是立体的。而第三点，是一个具体的技术方案，就是我们接下来要说的装饰器。

所谓装饰器，如果你对设计模式有所了解，你肯定知道有个设计模式叫装饰器模式。而装饰器模式的描述也很简单：对原有的对象添加新的功能，同时又不改变其结构。如果你联想力足够丰富，你可以第一时间反应过来，继承不也可以实现这一意图吗？和子类不同的是，装饰器和被装饰的对象是松耦合的，比如上面提到的日志功能，对应的装饰器根本不在乎它要装饰的是什么类的什么方法，也不在乎注入到对应的方法后方法的逻辑是否有后续的修改，自然，装饰器自身的修改也不会影响到注入的方法。

如果对于这一点的理解还不够深入，我们就可以聊更具体一点，ES中的装饰器是什么，它常见的应用场景有哪些？

